<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRG Brownsville, TX Permit Management System</title>

  <style>
    :root { --bg:#0b0c10; --panel:#121318; --muted:#9aa3b2; --fg:#f3f4f6; --accent:#6ee7b7; --danger:#ef4444; --border:#1f2430; }
    * { box-sizing:border-box }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:var(--bg); color:var(--fg); }
    header { padding:20px; border-bottom:1px solid var(--border); background:linear-gradient(180deg, #0b0c10 0%, #0d0f14 100%); position:sticky; top:0; z-index:10; text-align:center }
    h1 { margin:0; font-size:22px }

    main { max-width:1200px; margin:24px auto 56px; padding:0 16px }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px }
    .card { background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:16px }
    .muted { color:var(--muted) }
    .small { font-size:12px }
    .title { font-weight:700; font-size:16px; margin-bottom:8px }
    .status { display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid #283244; background:#0e1520; color:#c7d2fe }

    .kpi { display:flex; gap:14px; flex-wrap:wrap; margin:8px 0 0 }
    .kpi div { background:#0f1219; border:1px solid var(--border); border-radius:10px; padding:8px 10px; font-size:13px; color:var(--muted) }

    /* Taller scroll area for data */
    .list { display:grid; grid-template-columns: 1fr; gap:12px; max-height:72vh; overflow:auto; padding-right:4px }

    .row { display:grid; grid-template-columns: repeat(12, 1fr); gap:12px }
    .col-12 { grid-column: span 12 }
    .col-6  { grid-column: span 6 }
    .col-4  { grid-column: span 4 }
    .col-3  { grid-column: span 3 }

    label { font-size:13px; color:var(--muted); display:block; margin-bottom:6px }
    input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3242; background:#0f1219; color:var(--fg); }
    textarea { min-height:84px; resize:vertical }

    .btn { appearance:none; border:1px solid var(--border); background:#161922; color:var(--fg); padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600 }
    .btn:hover { background:#1a1f2b }
    .btn:disabled { opacity:.6; cursor:not-allowed }
    .btn-ghost { background:transparent; border-color:#2a3242 }
    .btn-accent { border-color:#1f3b2f; background:#0f2b22 }
    .flex { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .spacer { height:10px }

    /* Status colors */
    .badge-pending   { border-color:#7c4a03; background:#2c1f0a; color:#f59e0b } /* Submitted - Pending (orange) */
    /* Brighter, more distinct yellow for "Created - NOT Submitted" */
    .badge-created   { border-color:#a16207; background:#2a1f05; color:#fde047 } /* Created - NOT Submitted (yellow) */
    .badge-approved  { border-color:#14532d; background:#0c1f16; color:#22c55e } /* Approved (green) */
    .badge-na-cannot { border-color:#5b21b6; background:#22123b; color:#a855f7 } /* Not Approved - Cannot Attach (purple) */
    .badge-na-other  { border-color:#7f1d1d; background:#2b1111; color:#ef4444 } /* any other Not Approved - ... (red) */
    .badge-none      { border-color:#374151; background:#0e1520; color:#9aa3b2 } /* NONE */
    
    @media (max-width: 980px) { .grid { grid-template-columns: 1fr } .list { max-height:none } }
  </style>
</head>
<body>
  <header>
    <h1>DRG Brownsville, TX Permit Management System</h1>
  </header>

  <main>
    <div class="grid">
      <!-- LEFT COLUMN -->
      <section class="card">
        <div class="title">Filters</div>
        <div class="row">
          <div class="col-12">
            <label>Utility</label>
            <select id="selUtility"></select>
          </div>
          <div class="col-12">
            <label>Job Name</label>
            <select id="selJobName"></select>
          </div>
          <div class="col-12">
            <label>Search Tag or SCID</label>
            <input id="inpTagScid" placeholder="e.g., 1234 or 076" />
          </div>
        </div>

        <div class="spacer"></div>

        <div class="title">Current Data</div>
        <div id="status" class="muted small">Loading…</div>
        <div class="kpi">
          <div>Poles: <b id="kPoles">—</b></div>
          <div>Permits: <b id="kPermits">—</b></div>
          <div>Loaded: <b id="kLoaded">—</b></div>
          <div>Commit: <b id="kCommit">—</b></div>
        </div>

        <div class="spacer"></div>

        <div id="list" class="list"></div>
      </section>

      <!-- RIGHT COLUMN -->
      <section class="card">
        <div class="title">Pole Details</div>
        <div class="row">
          <div class="col-6">
            <label>Job Name</label>
            <input id="pdJobName" disabled />
          </div>
          <div class="col-6">
            <label>Owner</label>
            <input id="pdOwner" disabled />
          </div>

          <div class="col-6">
            <label>Tag</label>
            <input id="pdTag" disabled />
          </div>
          <div class="col-6">
            <label>SCID</label>
            <input id="pdSCID" disabled />
          </div>

          <div class="col-6">
            <label>Pole Spec</label>
            <input id="pdPoleSpec" disabled />
          </div>
          <div class="col-6">
            <label>Proposed Spec</label>
            <input id="pdProposedSpec" disabled />
          </div>

          <div class="col-6">
            <label>Latitude</label>
            <input id="pdLat" disabled />
          </div>
          <div class="col-6">
            <label>Longitude</label>
            <input id="pdLon" disabled />
          </div>

          <div class="col-12">
            <label>MR Level</label>
            <input id="pdMrLevel" disabled />
          </div>
        </div>

        <div class="spacer"></div>

        <div class="title">Permit Editor</div>
        <div class="small muted">Select an existing permit or choose “New”.</div>

        <div class="row">
          <div class="col-12">
            <label>Existing Permits for Selected Pole</label>
            <select id="permitPicker">
              <option value="">— New —</option>
            </select>
          </div>

          <div class="col-12">
            <label>Permit ID (required for new permits)</label>
            <input id="permitId" placeholder="e.g., PERM-BRN01-F300-1234-076" />
          </div>

          <div class="col-12">
            <label>Permit Status</label>
            <select id="permitStatus"></select>
          </div>

          <div class="col-12">
            <label>Submitted By (required)</label>
            <input id="permitBy" />
          </div>

          <div class="col-12">
            <label>Submitted At</label>
            <input id="permitAt" type="date" />
          </div>

          <div class="col-12">
            <label>Notes</label>
            <textarea id="permitNotes" rows="3" placeholder="Notes…"></textarea>
          </div>

          <div class="col-12">
            <button id="btnSavePermit" class="btn btn-accent">Save Permit</button>
            <span id="msgPermit" class="small muted"></span>
          </div>
        </div>

        <div class="spacer"></div>

        <div class="title">Admin</div>

        <div class="card" style="margin-bottom:12px;">
          <div class="title" style="margin-bottom:6px;">Export CSV</div>
          <div class="row">
            <div class="col-6">
              <label>Status Filter</label>
              <select id="exportStatus"></select>
            </div>
            <div class="col-6">
              <label>&nbsp;</label>
              <label class="small"><input type="checkbox" id="exportIncludeNone" /> Include poles with no permits (status NONE)</label>
            </div>
            <div class="col-12">
              <button id="btnExportCsv" class="btn">Download CSV</button>
              <span id="msgExport" class="small muted"></span>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="title" style="margin-bottom:6px;">Mass Create Permits (job-level)</div>
          <div class="small muted" id="bulkHint">Enabled only if the selected Job has no existing permits.</div>
          <div class="row">
            <div class="col-12">
              <label>Permit Status</label>
              <!-- This will be locked to "Submitted - Pending" by JS -->
              <select id="bulkStatus"></select>
            </div>
            <div class="col-6">
              <label>Submitted By (required)</label>
              <input id="bulkBy" />
            </div>
            <div class="col-6">
              <label>Submitted At</label>
              <input id="bulkAt" type="date" />
            </div>
            <div class="col-12">
              <label>Notes</label>
              <textarea id="bulkNotes" rows="3"></textarea>
            </div>
            <div class="col-12">
              <button id="btnBulkCreate" class="btn btn-accent" disabled>Mass Create Permits</button>
              <span id="msgBulk" class="small muted"></span>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script type="module" src="assets/js/app.js"></script>
</body>
</html>
