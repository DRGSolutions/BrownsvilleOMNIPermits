<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DRG Brownsville, TX Permit Management System</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <style>
    :root{
      --bg:#0b0c10; --panel:#121318; --muted:#9aa3b2; --fg:#f3f4f6;
      --accent:#6ee7b7; --danger:#ef4444; --border:#1f2430;
      --orange:#ff9f43; --green:#22c55e; --purple:#a78bfa; --yellow:#ffe866;
      --yellow-bg:#3b341a;
    }
    *{ box-sizing:border-box }
    body{ margin:0; background:var(--bg); color:var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    header{ padding:18px 16px; border-bottom:1px solid var(--border); text-align:center }
    h1{ margin:0; font-size:20px; font-weight:700 }
    main{ max-width:1200px; margin:18px auto 40px; padding:0 14px }
    .grid{ display:grid; grid-template-columns: 1.35fr 1fr; gap:16px } /* LEFT WIDER */
    .card{ background:var(--panel); border:1px solid var(--border); border-radius:12px; padding:14px }
    .row{ display:grid; grid-template-columns: repeat(12, 1fr); gap:10px }
    .col-12{ grid-column: span 12 }
    .col-6{ grid-column: span 6 }
    .col-4{ grid-column: span 4 }
    .col-3{ grid-column: span 3 }
    label{ font-size:12px; color:var(--muted); display:block; margin-bottom:6px }
    input, select, textarea{ width:100%; background:#0f1219; border:1px solid #2a3242; color:var(--fg);
      border-radius:10px; padding:9px 11px; }
    textarea{ min-height:90px; resize:vertical }
    .btn{ border:1px solid var(--border); background:#161922; color:var(--fg);
      padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600 }
    .btn:hover{ background:#1a1f2b }
    .btn:disabled{ opacity:.6; cursor:not-allowed }
    .btn-accent{ border-color:#1f3b2f; background:#0f2b22 }
    .btn-danger{ border-color:#3a1e1e; background:#2a1515 }
    .muted{ color:var(--muted) }
    .small{ font-size:12px }
    .list{ display:grid; gap:10px; max-height:680px; overflow:auto; padding-right:4px } /* LONGER SCROLLER */
    .title{ font-weight:700; font-size:15px; margin-bottom:6px }
    .kpi{ display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 8px }
    .kpi div{ background:#0f1219; border:1px solid var(--border); border-radius:10px; padding:8px 10px; font-size:12px; color:var(--muted) }
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; border:1px solid #283244; font-size:12px; background:#0e1520 }
    .chip.orange{ color:#ffb36b; border-color:#4b351e; background:#2a2017 }
    .chip.green{  color:#7ee6a2; border-color:#1e3b2a; background:#0f2b22 }
    .chip.red{    color:#ff9aa3; border-color:#502126; background:#2a1515 }
    .chip.purple{ color:#c7b8ff; border-color:#3a2f67; background:#221e36 }
    .chip.yellow{ color:#ffef8a; border-color:#584e1b; background:var(--yellow-bg) } /* brighter yellow */
    .spacer{ height:8px }
    .pill{ border:1px solid #283244; background:#0e1520; border-radius:10px; padding:2px 8px; font-size:12px; color:#cbd5e1 }
    .flex{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .right{ text-align:right }
    .link{ color:#7dd3fc; text-decoration:none }
    .link:hover{ text-decoration:underline }

    .two{ display:grid; grid-template-columns: 1fr 1fr; gap:10px }
    @media (max-width: 1000px){ .grid{ grid-template-columns: 1fr } .list{ max-height:none } }
  </style>
</head>
<body>
  <header>
    <h1>DRG Brownsville, TX Permit Management System</h1>
  </header>

  <main>
    <div class="grid">

      <!-- LEFT: Filters + Current Data -->
      <section class="card">
        <div class="title">Filters</div>
        <div class="row">
          <div class="col-12">
            <label>Utility</label>
            <select id="fltUtility">
              <option value="">All</option>
              <option>BPUB</option>
              <option>AEP</option>
              <option>MVEC</option>
            </select>
          </div>
          <div class="col-12">
            <label>Job Name</label>
            <select id="fltJob"></select>
          </div>
          <div class="col-12">
            <label>Search Tag or SCID</label>
            <input id="fltSearch" placeholder="e.g., 1234 or 076" />
          </div>
        </div>

        <div class="spacer"></div>
        <div class="title">Current Data</div>
        <div id="status" class="small muted">Loading…</div>
        <div class="kpi">
          <div>Poles: <b id="kPoles">—</b></div>
          <div>Permits: <b id="kPermits">—</b></div>
          <div>Loaded: <b id="kLoaded">—</b></div>
          <div>Commit: <b id="kSha">—</b></div>
        </div>

        <div id="pendingPanel" class="card" style="padding:10px; display:none;">
          <div class="title" style="margin-bottom:6px;">Change Monitor</div>
          <div id="pendingList" class="small muted">No pending changes.</div>
        </div>

        <div class="spacer"></div>
        <div id="list" class="list"></div>
      </section>

      <!-- RIGHT: Pole details (read-only) + Permit Editor + Admin -->
      <section class="card">
        <div class="title">Pole Details</div>
        <div class="row">
          <div class="col-6">
            <label>Job Name</label>
            <input id="pdJob" disabled />
          </div>
          <div class="col-6">
            <label>Owner</label>
            <input id="pdOwner" disabled />
          </div>
          <div class="col-6">
            <label>Tag</label>
            <input id="pdTag" disabled />
          </div>
          <div class="col-6">
            <label>SCID</label>
            <input id="pdScid" disabled />
          </div>
          <div class="col-6">
            <label>Pole Spec</label>
            <input id="pdSpec" disabled />
          </div>
          <div class="col-6">
            <label>Proposed Spec</label>
            <input id="pdPropSpec" disabled />
          </div>
          <div class="col-6">
            <label>Latitude</label>
            <input id="pdLat" disabled />
          </div>
          <div class="col-6">
            <label>Longitude</label>
            <input id="pdLon" disabled />
          </div>
          <div class="col-12">
            <label>MR Level</label>
            <input id="pdMr" disabled />
          </div>
        </div>

        <div class="spacer"></div>
        <div class="title">Permit Editor</div>
        <div class="small muted">Select an existing permit for the selected pole, or choose “New”.</div>
        <div class="spacer"></div>

        <div class="row">
          <div class="col-12">
            <select id="selPermit"></select>
          </div>

          <div class="col-12">
            <label>Permit ID (for new permits)</label>
            <input id="peId" placeholder="e.g., PERM-BRN01-F300-1234-076" />
          </div>

          <div class="col-12">
            <label>Permit Status</label>
            <select id="peStatus">
              <option>Created - NOT Submitted</option>
              <option>Submitted - Pending</option>
              <option>Approved</option>
              <option>Not Approved - Cannot Attach</option>
              <option>Not Approved - PLA Issues</option>
              <option>Not Approved - MRE Issues</option>
              <option>Not Approved - Other Issues</option>
              <option>NONE</option>
            </select>
          </div>

          <div class="col-12">
            <label>Submitted By (required)</label>
            <input id="peBy" />
          </div>

          <div class="col-12">
            <label>Submitted At</label>
            <input id="peDate" type="date" />
          </div>

          <div class="col-12">
            <label>Notes</label>
            <textarea id="peNotes" placeholder="At least 3 lines available for longer notes…"></textarea>
          </div>
        </div>

        <div class="spacer"></div>
        <div class="flex">
          <button id="btnSavePermit"  class="btn btn-accent">Save Permit</button>
          <button id="btnDeletePermit" class="btn btn-danger" disabled>Delete Permit</button>
          <span id="msgPermit" class="small muted"></span>
        </div>

        <div class="spacer"></div>
        <div class="title">Admin Tools</div>
        <div class="card" style="padding:12px">
          <div class="two">
            <div>
              <div class="small muted" style="margin-bottom:6px;">Export CSV (by current filters)</div>
              <button id="btnExportCsv" class="btn">Download CSV</button>
            </div>
            <div>
              <div class="small muted" style="margin-bottom:6px;">Mass Create Permits (only if job has <b>no permits</b>)</div>
              <div class="flex">
                <select id="massStatus" disabled>
                  <option>Submitted - Pending</option>
                </select>
                <input id="massBy" placeholder="Submitted By" />
                <input id="massDate" type="date" />
                <button id="btnMassCreate" class="btn" disabled>Mass Create</button>
              </div>
              <div id="massHint" class="small muted" style="margin-top:6px"></div>
            </div>
          </div>
        </div>

      </section>
    </div>
  </main>

  <!-- Config FIRST -->
  <script src="assets/js/config.js"></script>

  <!-- App logic (data loading, state, API calls) -->
  <script src="assets/js/app.js"></script>

  <!-- UI bindings & rendering -->
  <script src="assets/js/ui.js"></script>

  <!-- Watcher (auto refresh when repo head changes) -->
  <script src="assets/js/watch.js"></script>

  <!-- Export helpers -->
  <script src="assets/js/export.js"></script>
</body>
</html>
