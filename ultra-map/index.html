<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ultra Map — Year 2300</title>

  <!-- MapLibre GL -->
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">
  <script defer src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

  <!-- deck.gl (UMD) -->
  <script defer src="https://unpkg.com/deck.gl@8.9.36/dist.min.js"></script>

  <!-- Turf (geo helpers) -->
  <script defer src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <!-- Concaveman (fast concave hulls) -->
  <script defer src="https://unpkg.com/concaveman@1.2.1/concaveman.min.js"></script>

  <!-- Polygon clipping (martinez) via Turf.difference internally; (we’ll still import here if you want direct usage) -->
  <script defer src="https://unpkg.com/polygon-clipping@0.15.3/dist/polygon-clipping.min.js"></script>

  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div id="map"></div>

  <!-- FILTERS (top-left) -->
  <aside id="filterPanel" class="panel panel--filters">
    <div class="panel__head">
      <div class="title">Filters</div>
      <div class="muted small">Multi-condition (AND/OR)</div>
    </div>
    <div class="filter-toolbar">
      <select id="logicToggle" title="Group logic">
        <option value="AND">AND</option><option value="OR">OR</option>
      </select>
      <button class="btn" id="btnAddRule">Add</button>
      <button class="btn" id="btnClearRules">Clear</button>
      <button class="btn btn-accent" id="btnApplyRules">Apply</button>
    </div>
    <div id="rules"></div>
    <div id="activeChips" class="chips"></div>
  </aside>

  <!-- LEGEND (bottom-left) -->
  <aside id="legend" class="panel panel--legend">
    <div class="legend__row">
      <div class="legend__title">Owner Shapes</div>
      <div class="legend__shapes">
        <span class="lg-item"><span class="lg-shape" data-shape="circle"></span> BPUB</span>
        <span class="lg-item"><span class="lg-shape" data-shape="triangle"></span> AEP</span>
        <span class="lg-item"><span class="lg-shape" data-shape="diamond"></span> MVEC</span>
      </div>
    </div>
    <div class="legend__row">
      <div class="legend__title">Permit Status Colors</div>
      <div id="legendStatuses" class="legend__status"></div>
    </div>
    <div class="legend__row">
      <label class="small"><input type="checkbox" id="toggleBoundaries" checked> Show Job Boundaries</label>
    </div>
  </aside>

  <!-- DETAILS (right) -->
  <aside id="details" class="panel panel--details">
    <div class="panel__head">
      <div class="title">Pole & Permits</div>
      <button class="btn" id="btnReportToggle">Report</button>
    </div>
    <div id="detailsBody" class="details"></div>
  </aside>

  <!-- REPORT (top-right) -->
  <aside id="report" class="panel panel--report hidden">
    <div class="panel__head">
      <div class="title">Visual Report</div>
      <button class="btn" id="btnReportClose">Close</button>
    </div>
    <div id="reportBody" class="report"></div>
  </aside>

  <!-- Toast -->
  <div id="toast" class="toast" aria-live="polite"></div>

  <!-- Our modules -->
  <script type="module" src="./config.js"></script>
  <script type="module" src="./data.js"></script>
  <script type="module" src="./atlas.js"></script>
  <script type="module" src="./filters.js"></script>
  <script type="module" src="./boundaries.js"></script>
  <script type="module" src="./ui.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
