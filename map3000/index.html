<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pole & Permit Map â€” Modular (Fixed)</title>

<link rel="stylesheet" href="./css/style.css" />

<!-- Leaflet + MarkerCluster + Heat + Turf -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
<script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script defer src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script defer src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>
<script defer src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

<style>
  /* tiny inline overlay in case something goes wrong */
  #boot-error{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0a0f18;color:#fff;z-index:9999}
  #boot-error .box{max-width:820px;border:1px solid #162032;border-radius:12px;padding:16px;background:#0b111d;font-family:ui-sans-serif,system-ui}
  #boot-error pre{white-space:pre-wrap;word-break:break-word;color:#eab308;margin:8px 0 0}
</style>
</head>
<body>
<div id="map"></div>
<div id="bgfx"></div>

<!-- Panels (JS populates content) -->
<div id="filters" class="panel"></div>
<div id="legend"  class="panel"></div>
<div id="tools"   class="panel"></div>
<aside id="report" class="drawer"></aside>
<div id="toast"></div>

<!-- Error overlay -->
<div id="boot-error"><div class="box">
  <strong>Map failed to start.</strong>
  <div class="muted" style="margin-top:6px">Common causes: double boot, module path typo, or blocked CDN.</div>
  <pre id="boot-msg"></pre>
</div></div>

<!-- Single, safe boot -->
<script type="module">
  const showBootError = (msg) => {
    document.getElementById('boot-msg').textContent = String(msg || 'Unknown error');
    document.getElementById('boot-error').style.display = 'flex';
    console.error('[boot]', msg);
  };
  try {
    await new Promise(r => setTimeout(r, 0));  // let deferred scripts attach
    if (!window.L) throw new Error('Leaflet not loaded (CDN blocked?)');
    const app = await import('./js/app.js');
    await app.start();
  } catch (e) {
    showBootError(e && (e.stack || e.message || e));
  }
</script>
</body>
</html>
